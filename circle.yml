machine:
  java:
    version: oraclejdk8
dependencies:
  override:
    - mvn --fail-never dependency:go-offline || true
test:
  override:
    - mvn clean verify org.jacoco:jacoco-maven-plugin:report -Dmaven.test.failure.ignore=true
    # copy the test results to the test results directory.
    - cp -r **/target/surefire-reports/* $CIRCLE_TEST_REPORTS
  post:
    - sudo apt-get install jq
    - wget -O ~/codacy-coverage-reporter-assembly-latest.jar $(curl https://api.github.com/repos/codacy/codacy-coverage-reporter/releases/latest | jq -r .assets[0].browser_download_url)
    - java -cp ~/codacy-coverage-reporter-assembly-latest.jar com.codacy.CodacyCoverageReporter -l Java -r collecting-data/build/reports/jacoco/test/jacocoTestReport.xml 
    - java -cp ~/codacy-coverage-reporter-assembly-latest.jar com.codacy.CodacyCoverageReporter -l Java -r maps/build/reports/jacoco/test/jacocoTestReport.xml 
    - java -cp ~/codacy-coverage-reporter-assembly-latest.jar com.codacy.CodacyCoverageReporter -l Java -r numericstreams/build/reports/jacoco/test/jacocoTestReport.xml 
    - java -cp ~/codacy-coverage-reporter-assembly-latest.jar com.codacy.CodacyCoverageReporter -l Java -r pythagorean-triples/build/reports/jacoco/test/jacocoTestReport.xml 
    - java -cp ~/codacy-coverage-reporter-assembly-latest.jar com.codacy.CodacyCoverageReporter -l Java -r streams/build/reports/jacoco/test/jacocoTestReport.xml 
    - java -cp ~/codacy-coverage-reporter-assembly-latest.jar com.codacy.CodacyCoverageReporter -l Java -r string-streams/build/reports/jacoco/test/jacocoTestReport.xml 

notify:
  webhooks:
    - url: https://webhook.atomist.com/atomist/circle/teams/T7Z55PASE
